"use strict";function _defineProperty(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}var googleMap=googleMap||{},google=google;googleMap.init=function(){this.apiUrl="http://localhost:3000/api",this.$modal=$(".modal-content"),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),$(".findme").on("click",this.whereAmI.bind(this)),this.$modal.on("submit","form",this.handleForm),$("body").on("click",".refreshMarkers",this.repositionMap),this.mapSetup(),this.getToken()?this.loggedInState():this.loggedOutState()},googleMap.repositionMap=function(){console.log("firing"),setTimeout(function(){googleMap.map.panTo(new google.maps.LatLng(51.512178,(-.108369))),googleMap.map.setZoom(12)},200)},googleMap.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),$("#map-container").removeClass("blurry"),this.getVenues()},googleMap.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.register(),$("#map-container").addClass("blurry")},googleMap.register=function(e){e&&e.preventDefault(),this.$modal.html('\n    <form method="post" action="/register">\n    <div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <h4 class="modal-title">Register</h4>\n    </div>\n    <div class="modal-body">\n    <div class="form-group">\n    <input class="form-control" type="text" name="user[username]" placeholder="Username">\n    </div>\n    <div class="form-group">\n    <input class="form-control" type="email" name="user[email]" placeholder="Email">\n    </div>\n    <div class="form-group">\n    <input class="form-control" type="password" name="user[password]" placeholder="Password">\n    </div>\n    <div class="form-group">\n    <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n    </div>\n    </div>\n    <div class="modal-footer">\n    <input class="btn btn-primary" type="submit" value="Register">\n    </div>\n    </form>\n    '),$(".modal").modal("show")},googleMap.login=function(e){e&&e.preventDefault(),this.$modal.html('\n      <form method="post" action="/login">\n      <div class="modal-header">\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n      <h4 class="modal-title">Login</h4>\n      </div>\n      <div class="modal-body">\n      <div class="form-group">\n      <input class="form-control" type="email" name="email" placeholder="Email">\n      </div>\n      <div class="form-group">\n      <input class="form-control" type="password" name="password" placeholder="Password">\n      </div>\n      </div>\n      <div class="modal-footer">\n      <input class="btn btn-primary" type="submit" value="Login">\n      </div>\n      </form>\n      '),$(".modal").modal("show")},googleMap.logout=function(e){e.preventDefault(),this.removeToken(),this.loggedOutState()},googleMap.handleForm=function(e){e.preventDefault();var o=""+googleMap.apiUrl+$(this).attr("action"),t=$(this).attr("method"),a=$(this).serialize();return googleMap.ajaxRequest(o,t,a,function(e){e.token&&googleMap.setToken(e.token),googleMap.loggedInState(),$(".modal").modal("hide")})},googleMap.ajaxRequest=function(e,o,t,a){return $.ajax({url:e,method:o,data:t,beforeSend:this.setRequestHeader.bind(this)}).done(a).fail(function(e){console.log(e)})},googleMap.setRequestHeader=function(e){return e.setRequestHeader("Authorization","Bearer "+this.getToken())},googleMap.setToken=function(e){return window.localStorage.setItem("token",e)},googleMap.getToken=function(){return window.localStorage.getItem("token")},googleMap.removeToken=function(){return window.localStorage.clear()},googleMap.mapSetup=function(){var e=document.getElementById("map-container"),o={zoom:12,center:new google.maps.LatLng(51.512178,(-.108369)),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"},{lightness:17}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:20}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:16}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:21}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#dedede"},{lightness:21}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#333333"},{lightness:40}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2f2f2"},{lightness:19}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]}]};this.map=new google.maps.Map(e,o)},googleMap.whereAmI=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var o={lat:e.coords.latitude,lng:e.coords.longitude},t=new google.maps.LatLng(o.lat,o.lng),a={url:"../images/user_on_map_2_small.png",scaledSize:new google.maps.Size(60,60)};new google.maps.Marker({position:t,map:googleMap.map,animation:google.maps.Animation.DROP,icon:a}),new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:googleMap.map,center:t,radius:3e3})})},googleMap.getVenues=function(){$.get("http://localhost:3000/api/venues").done(this.loopThroughVenues)},googleMap.loopThroughVenues=function(e){$.each(e.venues,function(e,o){setTimeout(function(){googleMap.createMarkerForVenue(o)},100*e)})},googleMap.createMarkerForVenue=function(e){var o=new google.maps.LatLng(e.lat,e.lng),t={url:"https://d30y9cdsu7xlg0.cloudfront.net/png/1882-200.png",scaledSize:new google.maps.Size(50,50)},a=new google.maps.Marker(_defineProperty({map:googleMap.map,animation:google.maps.Animation.DROP,icon:t,position:o},"map",this.map));this.addModalForVenue(e,a)},googleMap.addModalForVenue=function(e,o){var t=this;google.maps.event.addListener(o,"click",function(){return googleMap.getToken()?($(".modal-content").html('\n            <div class="modal-header">\n            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n            <h4 class="modal-title">'+e.name+'</h4>\n            </div>\n            <div class="modal-body">\n            <img class="imageModal" src="'+e.image+'">\n            <p>Phone: '+e.phone+"</p>\n            <p>Address: "+e.address+"</p>\n            <p>Price: "+e.price+'</p>\n            <a href="'+e.info+'">More Info</a>\n            </div>\n            <div class="modal-footer">\n            <a href="https://citymapper.com/directions?endcoord=51.560555%2C-0.074077&endaddress='+e.address+'" target="_blank"><img src="/images/citymapper.png"></a>\n            </div>'),$(".modal").modal("show"),t.map.setCenter(o.getPosition()),void t.map.setZoom(15)):googleMap.login()})},$(googleMap.init.bind(googleMap));